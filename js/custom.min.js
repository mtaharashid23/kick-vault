$(function () {
    lenisSetup()
    replaceHash()
    sliderInit()
    headingAnimation()
    mousecursor()
    btnHover()
    AOS.init({
        duration: 1500,
        disable: "mobile",
    });
})

$(window).on('load', function () {
    if ($(".preLoader").length > 0) {
        preLoader();
    }
});

function preLoader() {
    const preLoader = document.querySelector(".preLoader");
    if (!preLoader) return;
    let counts = setInterval(updated, 4);
    let upto = 0;

    function updated() {
        let count = document.querySelector(".preLoader .counter span");
        count.innerHTML = ++upto;
        if (upto === 100) {
            clearInterval(counts);
            startAnimation();
        }
    }

    function startAnimation() {
        const tl = gsap.timeline({
            duration: 0.1,
        });
        tl.to(".preLoader .counter", {
                autoAlpha: 0,
            })
            .to(".preLoader .line", {
                width: "100%",
                duration: 0.5,
            }) // Line animation starts after the counter ends
            .to(".preLoader .line", {
                xPercent: 100,
            })
            .to(".preLoader .bar", {
                height: 0,
                stagger: 0.09,
                ease: "power4.inOut",
            })
            .to(".preLoader", {
                css: {
                    display: "none",
                },
            })
            .from(
                ".header-top", {
                    y: -50,
                    autoAlpha: 0,
                    stagger: 0.1,
                },
                "-=0.5"
            )
            .from(
                ".header-main__form, .header-main__logo, .header-main__links li", {
                    y: -50,
                    autoAlpha: 0,
                },
                "-=0.375"
            )
            .from(
                ".header-nav__list li", {
                    autoAlpha: 0,
                    x: -100,
                    stagger: 0.05,
                },
                "-=0.375"
            )
            .from(".banner", {
                autoAlpha: 0,
                stagger: 0.1,
            })
            .from(".banner-content", {
                y: 50,
                autoAlpha: 0,
                stagger: 0.1,
            });

        document.querySelector("body").classList.remove("loading");
    }
}

function lenisSetup() {
    const lenis = new Lenis({
        duration: 1.5,
        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
        smooth: true,
        mouseMultiplier: 1,
    });

    function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
    }
    requestAnimationFrame(raf);
    document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            lenis.scrollTo(this.getAttribute("href"));
        });
    });
    lenis.scrollTo("top");
}

function replaceHash() {
    document.querySelectorAll("a").forEach((a) => {
        let href = a.getAttribute("href");
        a.href = href ?
            href.startsWith("#") && href.endsWith("#") ?
            href.replace("#", "javascript:void(0)") :
            href :
            "javascript:void(0)";
    });
}

function sliderInit() {
    const swiperOptions = {
        loop: true,
        speed: 1000,
        parallax: true,
        autoplay: {
            delay: 3500,
            disableOnInteraction: false,
        },
        autoplay: false,
        grabCursor: false,
        pagination: {
            el: '.swiper-pagination',
            clickable: true
        },
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev'
        }
    };
    var bannerSlider = new Swiper('.bannerSlider', swiperOptions);
    var pageSections = document.querySelectorAll('.bannerImg');
    pageSections.forEach(function (pageSection) {
        var backgroundUrl = pageSection.getAttribute('data-background');
        if (backgroundUrl) {
            pageSection.style.backgroundImage = 'url(' + backgroundUrl + ')';
        }
    });

    var testimonailSlider = new Swiper('.testimonailSlider', {
        loop: true,
        // autoplay: true,
        slidesPerView: 1,
        spaceBetween: 10,
        centeredSlides: true,
        roundLengths: true,

        navigation: {
            nextEl: '.testimonail-button-next',
            prevEl: '.testimonail-button-prev'
        },
    });

    var industrySlider = new Swiper('.industrySlider', {
        loop: true,
        slidesPerView: 4,
        spaceBetween: 20,
        breakpoints: {
            1024: {
                slidesPerView: 4,
                spaceBetween: 20
            },
            768: {
                slidesPerView: 1,
                spaceBetween: 20
            },
            640: {
                slidesPerView: 1,
                spaceBetween: 10
            },
            576: {
                slidesPerView: 1,
                spaceBetween: 10
            },
            375: {
                slidesPerView: 1,
                spaceBetween: 10
            }
        },
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev'
        },
        scrollbar: {
            el: '.swiper-scrollbar'
        }
    });
}

function headingAnimation() {
    const headings = document.querySelectorAll(".heading");

    headings.forEach((text) => {
        let text1 = new SplitType(text, {
            types: "chars",
        });
        const headingTl = gsap.timeline({
            scrollTrigger: {
                trigger: text,
                toggleActions: "play none none reset",
            },
        });
        let chars = text.querySelectorAll(".char");
        headingTl.from(chars, 1.2, {
            y: 80,
            opacity: 0,
            scale: 1.2,
            rotationX: -90,
            transformOrigin: "bottom center",
            stagger: 0.05,
            ease: "expo.out",
        });
    });
}

function mousecursor() {
    if ($("body")) {
        const e = document.querySelector(".cursor-inner"),
            t = document.querySelector(".cursor-outer");
        let n,
            i = 0,
            o = !1;
        (window.onmousemove = function (s) {
            o ||
                (t.style.transform =
                    "translate(" + s.clientX + "px, " + s.clientY + "px)"),
                (e.style.transform =
                    "translate(" + s.clientX + "px, " + s.clientY + "px)"),
                (n = s.clientY),
                (i = s.clientX);
        }),
        $("body").on("mouseenter", "a, img, .cursor-pointer", function () {
                e.classList.add("cursor-hover"), t.classList.add("cursor-hover");
            }),
            $("body").on("mouseleave", "a, img, .cursor-pointer", function () {
                ($(this).is("a, img") && $(this).closest(".cursor-pointer").length) ||
                (e.classList.remove("cursor-hover"),
                    t.classList.remove("cursor-hover"));
            }),
            (e.style.visibility = "visible"),
            (t.style.visibility = "visible");
    }
}

function btnHover() {
    const buttons = gsap.utils.toArray(".themeBtn");
    buttons.forEach((item) => {
        let text1 = new SplitType(item, {
            types: "chars",
        });
        let chars = item.querySelectorAll(".char");
        let tl = gsap.timeline({
            paused: true,
        });

        tl.to(chars, {
            duration: 0.5,
            yPercent: -150,
            ease: "power2.in",
        });
        tl.set(chars, {
            yPercent: 150,
        });
        tl.to(chars, {
            duration: 0.5,
            yPercent: 0,
            stagger: 0.1,
            ease: "back.inOut(3)",
        });

        item.addEventListener("mouseenter", () => tl.play(0));
    });
}